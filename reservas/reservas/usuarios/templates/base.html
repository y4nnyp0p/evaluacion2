{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}ReserAPP{% endblock %}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="{% static 'css/styles.css' %}" rel="stylesheet">
  {% block extra_css %}{% endblock %}
</head>
<body>
<div id="wrapper">
  {% with path=request.path %}
  <nav id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <img src="{% static 'img/logo.png' %}" alt="ReserAPP" class="logo">
      <div class="brand-name text-uppercase">ReserAPP</div>
      <small class="text-white-50">Sistema de reservas</small>
    </div>
    <ul class="nav flex-column flex-grow-1">
      <li class="nav-item">
        <a href="{% url 'home' %}" class="nav-link {% if path == '/' or path == '/index/' or path == '/cliente/' %}active{% endif %}">
          <i class="bi bi-house-door me-2"></i><span>Inicio</span>
        </a>
      </li>
      {% if request.user.is_authenticated %}
      <li class="nav-item">
        <a href="{% url 'listar_rutas_cliente' %}" class="nav-link {% if '/rutas/clientes/' in path or '/rutas/reservar/' in path or '/rutas/mis-reservas/' in path %}active{% endif %}">
          <i class="bi bi-compass me-2"></i><span>Explorar rutas</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="{% url 'mis_reservas' %}" class="nav-link {% if '/rutas/mis-reservas/' in path %}active{% endif %}">
          <i class="bi bi-ticket-detailed me-2"></i><span>Mis reservas</span>
        </a>
      </li>
      {% endif %}
      {% if request.user.is_authenticated and request.user.es_admin %}
      <li class="nav-item">
        <a href="{% url 'listar_rutas' %}" class="nav-link {% if '/rutas/' in path and '/rutas/clientes/' not in path and '/rutas/mis-reservas/' not in path and '/rutas/reservar/' not in path %}active{% endif %}">
          <i class="bi bi-bus-front me-2"></i><span>Panel rutas</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="{% url 'inicio_admin' %}" class="nav-link {% if path == '/index_admin/' %}active{% endif %}">
          <i class="bi bi-speedometer2 me-2"></i><span>Indicadores</span>
        </a>
      </li>
      {% endif %}
    </ul>
    <div class="sidebar-footer">
      <div>ReserAPP v1.0</div>
      <div>Siempre a tiempo</div>
    </div>
  </nav>
  {% endwith %}

  <div id="content">
    <header class="topbar">
      <div class="d-flex align-items-center gap-3">
        <button id="btnToggle" class="btn btn-outline-secondary btn-sm">
          <i class="bi bi-list"></i>
        </button>
        <a href="{% url 'home' %}" class="brand-mini">
          <img src="{% static 'img/logo.png' %}" alt="ReserAPP mini" width="32" height="32" class="rounded-3">
          <span>ReserAPP</span>
        </a>
      </div>

      <form class="d-none d-md-flex ms-4 search-box" method="get" action="{% url 'rutas_disponibles' %}">
        <div class="input-group input-group-sm">
          <input class="form-control" name="q" placeholder="Buscar rutas..." aria-label="Buscar">
          <button class="btn btn-outline-secondary" type="submit">
            <i class="bi bi-search"></i>
          </button>
        </div>
      </form>

      <div class="ms-auto d-flex align-items-center gap-3">
        {% if request.user.is_authenticated %}
          <div class="dropdown">
            <a class="user-pill dropdown-toggle text-dark" href="#" data-bs-toggle="dropdown">
              <img src="{% static 'img/avatar-default.png' %}" alt="avatar" class="avatar">
              <span>{{ request.user.username }}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><span class="dropdown-item-text text-muted small">Sesion iniciada</span></li>
              {% if request.user.es_admin %}
              <li><a class="dropdown-item" href="{% url 'admin:index' %}">Django admin</a></li>
              {% endif %}
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" href="{% url 'salir' %}">Cerrar sesion</a></li>
            </ul>
          </div>
        {% else %}
          <a href="{% url 'ingreso_modal' %}" class="btn btn-primary btn-sm">Ingresar o registrarse</a>
        {% endif %}
      </div>
    </header>

    <main>
      {% block content %}{% endblock %}
    </main>

    <footer class="app-footer">
      &copy; {% now "Y" %} ReserAPP. Viajes confiables para todos tus destinos.
    </footer>
  </div>
</div>

{% if messages %}
  <div class="messages-container">
    {% for message in messages %}
      <div class="alert alert-floating alert-{{ message.tags|default:'info' }} alert-dismissible fade show" role="alert" data-auto-dismiss="5000">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% block extra_js %}{% endblock %}
<script src="{% static 'js/main.js' %}"></script>
</body>
</html>
